<?xml version="1.0" encoding="UTF-8"?>
<launch>
    <arg name="fake_depth_cameras" default="false" />
    <arg name="fake_marsviz_gps" default="false" />

    <rosparam command="load" file="$(find curiosity_mars_rover_control)/config/control_joint_state.yaml" />
    <rosparam command="load" file="$(find curiosity_mars_rover_control)/config/control_ackermann_drive.yaml" />
    <group if="$(arg fake_marsviz_gps)">
        <param name="curiosity_mars_rover/ackermann_drive_controller/enable_odom_tf" value="false" />
        <node name="curiosity_rover_fake_gps_node"
        pkg="curiosity_mars_rover_control"
        type="gps_publish.py"
        respawn="false"
        output="screen"
        args=""/>
    </group>

    <!-- Spawn the controllers  -->
    <node name="controller_manager" pkg="controller_manager" type="spawner" respawn="false"
            output="screen" args="--namespace=/curiosity_mars_rover
                                ackermann_drive_controller
                                joint_state_controller
                                suspension_arm_F_L_joint_position_controller
                                suspension_arm_B_L_joint_position_controller
                                suspension_arm_B2_L_joint_position_controller
                                suspension_arm_F_R_joint_position_controller
                                suspension_arm_B_R_joint_position_controller
                                suspension_arm_B2_R_joint_position_controller
                                mast_p_joint_position_controller
                                mast_02_joint_position_controller
                                mast_cameras_joint_position_controller
                                arm_01_joint_position_controller
                                arm_02_joint_position_controller
                                arm_03_joint_position_controller
                                arm_04_joint_position_controller
                                arm_tools_joint_position_controller">
    </node>

    <!-- Launch the robot state publisher -->
    <node name="robot_state_publisher" pkg="robot_state_publisher" type="robot_state_publisher"
        respawn="false" output="screen">
            <param name="publish_frequency" type="double" value="50" />
            <remap from="/joint_states" to="/curiosity_mars_rover/joint_states" />
    </node>
    
    <include file="$(find curiosity_mars_rover_control)/launch/curiosity_mars_rover_systems.launch"/>
    
    <group unless="$(arg fake_depth_cameras)">
        <group unless="$(arg fake_marsviz_gps)">
            <node name="rviz" pkg="rviz" type="rviz" args="-d $(find curiosity_mars_rover_control)/rviz/curiosity_mars_rover.rviz" />  
        </group>
    </group>
    
    <group if="$(arg fake_depth_cameras)">
        <node name="rviz" pkg="rviz" type="rviz" args="-d $(find curiosity_mars_rover_control)/rviz/curiosity_mars_rover_fake_depth.rviz" />
    </group>

</launch>
